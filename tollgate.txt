graph TB
    User[ğŸ‘¤ Business User<br/>Operations/Audit/Compliance]
    UI[ğŸ–¥ï¸ Web Interface<br/>Trade Dashboard]
    API[âš¡ API Server<br/>Request Handler]
    Cache{ğŸ’¾ Narrative Cache<br/>Already Generated?}
    MCP[ğŸ”§ MCP Architecture<br/>Tool Orchestration]
    Tools[ğŸ› ï¸ Data Access Tools<br/>Trade Queries & Analysis]
    DB[(ğŸ“Š PostgreSQL Database<br/>CDM Trade Data)]
    LLM[ğŸ¤– Large Language Model<br/>AI Narrative Generation]
    Stream[ğŸ“¡ Live Progress Stream<br/>Real-time Updates]
    SaveCache[ğŸ’¾ Save to Cache<br/>For Future Use]
    
    User -->|1. Request narrative for<br/>trade or event| UI
    UI -->|2. Send request| API
    API -->|3. Check cache| Cache
    
    Cache -->|Found: Return instantly| UI
    Cache -->|Not found: Generate new| MCP
    
    MCP -->|4. Discover & prepare<br/>available tools| Tools
    Tools -->|5. Query trade data,<br/>lineage & events| DB
    DB -->|6. Return CDM data| Tools
    
    Tools -->|7. Provide data context| LLM
    MCP -->|8. Orchestrate analysis| LLM
    
    LLM -->|9. Generate narrative<br/>with reasoning| MCP
    MCP -->|10. Stream progress| Stream
    Stream -->|11. Show live updates| UI
    
    MCP -->|12. Final narrative| SaveCache
    SaveCache -->|13. Store for reuse| DB
    SaveCache -->|14. Deliver result| UI
    UI -->|15. Display plain-English<br/>explanation| User
    
    style User fill:#e8f4f8
    style UI fill:#e8f4f8
    style API fill:#f0f0f0
    style Cache fill:#fff4e6
    style MCP fill:#f0f0f0
    style Tools fill:#f0f0f0
    style DB fill:#e6f3ff
    style LLM fill:#f5f0ff
    style Stream fill:#e8f4f8
    style SaveCache fill:#fff4e6